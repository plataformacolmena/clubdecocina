<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Prueba de Plantillas de Email - Club de Cocina</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .template-preview {
            background: white;
            margin: 20px 0;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        h1 {
            color: #e74c3c;
            text-align: center;
        }
        h2 {
            color: #c0392b;
            border-bottom: 2px solid #e74c3c;
            padding-bottom: 10px;
        }
        .test-data {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .preview-iframe {
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .test-button {
            background: #e74c3c;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        .test-button:hover {
            background: #c0392b;
        }
    </style>
</head>
<body>
    <h1>üß™ Test de Plantillas de Email - Club de Cocina</h1>
    
    <div class="template-preview">
        <h2>üìß Confirmaci√≥n de Inscripci√≥n</h2>
        <div class="test-data">
            <strong>Datos de prueba:</strong><br>
            Alumno: Mar√≠a Garc√≠a<br>
            Email: maria@example.com<br>
            Curso: Pasta Italiana Casera<br>
            Fecha: 2024-02-15<br>
            Precio: $1500
        </div>
        <button class="test-button" onclick="testConfirmacionInscripcion()">Probar Plantilla</button>
        <div id="preview-confirmacion" style="margin-top: 20px;"></div>
    </div>

    <div class="template-preview">
        <h2>‚è∞ Recordatorio de Curso</h2>
        <div class="test-data">
            <strong>Datos de prueba:</strong><br>
            Alumno: Juan P√©rez<br>
            Curso: Sushi para Principiantes<br>
            Fecha: Ma√±ana<br>
            Horario: 19:00 - 21:00
        </div>
        <button class="test-button" onclick="testRecordatorio()">Probar Plantilla</button>
        <div id="preview-recordatorio" style="margin-top: 20px;"></div>
    </div>

    <div class="template-preview">
        <h2>üìñ Nueva Receta</h2>
        <div class="test-data">
            <strong>Datos de prueba:</strong><br>
            Alumno: Ana L√≥pez<br>
            Receta: Risotto de Hongos<br>
            Dificultad: Intermedio<br>
            Tiempo: 45 minutos<br>
            Porciones: 4
        </div>
        <button class="test-button" onclick="testNuevaReceta()">Probar Plantilla</button>
        <div id="preview-receta" style="margin-top: 20px;"></div>
    </div>

    <div class="template-preview">
        <h2>üîî Notificaci√≥n Admin</h2>
        <div class="test-data">
            <strong>Datos de prueba:</strong><br>
            Nueva inscripci√≥n recibida<br>
            Alumno: Carlos Mendoza<br>
            Curso: Panader√≠a Artesanal<br>
            Estado de pago: Confirmado
        </div>
        <button class="test-button" onclick="testNotificacionAdmin()">Probar Plantilla</button>
        <div id="preview-admin" style="margin-top: 20px;"></div>
    </div>

    <div class="template-preview">
        <h2>üìù Email Personalizado</h2>
        <div class="test-data">
            <strong>Datos de prueba:</strong><br>
            T√≠tulo: Bienvenido al Club de Cocina<br>
            Mensaje: Gracias por unirte a nuestra comunidad<br>
            Bot√≥n: Explorar Cursos
        </div>
        <button class="test-button" onclick="testEmailPersonalizado()">Probar Plantilla</button>
        <div id="preview-personalizado" style="margin-top: 20px;"></div>
    </div>

    <div style="text-align: center; margin: 40px 0;">
        <h2>üöÄ Instrucciones de Uso</h2>
        <p>1. Copie el c√≥digo del archivo <code>gmail-apps-script.gs</code> en Google Apps Script</p>
        <p>2. Configure las variables del proyecto (CONFIG)</p>
        <p>3. Despliegue como Web App con permisos apropiados</p>
        <p>4. Pruebe las plantillas usando este documento</p>
        <p><strong>URL del Apps Script:</strong></p>
        <input type="url" id="script-url-input" placeholder="https://script.google.com/macros/s/.../exec" style="width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ddd; border-radius: 5px;">
        <button onclick="saveScriptUrl()" style="background: #28a745; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer;">Guardar URL</button>
        
        <div style="margin: 20px 0; padding: 20px; background: #fff3cd; border-radius: 5px;">
            <h3>‚úÖ Ventajas de las Plantillas Simplificadas:</h3>
            <ul style="text-align: left; max-width: 500px; margin: 0 auto;">
                <li>Compatible con todos los clientes de webmail</li>
                <li>Usa tablas HTML para layout confiable</li>
                <li>Estilos inline para m√°xima compatibilidad</li>
                <li>Dise√±o responsive y legible</li>
                <li>Funciones helper reutilizables</li>
            </ul>
        </div>
    </div>

    <script>
        // Datos de prueba para las plantillas
        const testData = {
            confirmacion: {
                alumno: { nombre: 'Mar√≠a Garc√≠a', email: 'maria@example.com' },
                curso: { 
                    nombre: 'Pasta Italiana Casera', 
                    fecha: '2024-02-15', 
                    horario: '18:00 - 20:00',
                    precio: 1500,
                    instructor: 'Chef Roberto'
                },
                sede: { direccion: 'Av. Corrientes 1234, CABA' }
            },
            recordatorio: {
                alumno: { nombre: 'Juan P√©rez', email: 'juan@example.com' },
                curso: { 
                    nombre: 'Sushi para Principiantes', 
                    fecha: new Date(Date.now() + 86400000).toISOString().split('T')[0],
                    horario: '19:00 - 21:00'
                },
                sede: { direccion: 'Palermo, Buenos Aires' }
            },
            receta: {
                alumno: { nombre: 'Ana L√≥pez', email: 'ana@example.com' },
                receta: {
                    nombre: 'Risotto de Hongos',
                    descripcion: 'Un cl√°sico italiano cremoso y delicioso',
                    dificultad: 'Intermedio',
                    tiempoPreparacion: 45,
                    porciones: 4,
                    ingredientes: ['400g arroz arborio', '300g hongos mixtos', '1 litro caldo de vegetales', '1 cebolla', 'Vino blanco', 'Queso parmesano'],
                    id: 'risotto-hongos-001'
                }
            }
        };

        async function testConfirmacionInscripcion() {
            showTestResult('preview-confirmacion', 'Probando plantilla de Confirmaci√≥n de Inscripci√≥n...');
            try {
                await testTemplate('confirmacion_inscripcion', testData.confirmacion);
                showTestResult('preview-confirmacion', 'Plantilla de Confirmaci√≥n de Inscripci√≥n probada correctamente');
            } catch (error) {
                showTestResult('preview-confirmacion', `Error: ${error.message}`, 'error');
            }
        }

        async function testRecordatorio() {
            showTestResult('preview-recordatorio', 'Probando plantilla de Recordatorio...');
            try {
                await testTemplate('recordatorio_curso', testData.recordatorio);
                showTestResult('preview-recordatorio', 'Plantilla de Recordatorio probada correctamente');
            } catch (error) {
                showTestResult('preview-recordatorio', `Error: ${error.message}`, 'error');
            }
        }

        async function testNuevaReceta() {
            showTestResult('preview-receta', 'Probando plantilla de Nueva Receta...');
            try {
                await testTemplate('nueva_receta', testData.receta);
                showTestResult('preview-receta', 'Plantilla de Nueva Receta probada correctamente');
            } catch (error) {
                showTestResult('preview-receta', `Error: ${error.message}`, 'error');
            }
        }

        async function testNotificacionAdmin() {
            showTestResult('preview-admin', 'Probando plantilla de Notificaci√≥n Admin...');
            try {
                await testTemplate('nueva_inscripcion', testData.confirmacion);
                showTestResult('preview-admin', 'Plantilla de Notificaci√≥n Admin probada correctamente');
            } catch (error) {
                showTestResult('preview-admin', `Error: ${error.message}`, 'error');
            }
        }

        async function testEmailPersonalizado() {
            showTestResult('preview-personalizado', 'Probando plantilla de Email Personalizado...');
            try {
                const personalData = {
                    tipo: 'email_personalizado',
                    destinatario: 'test@clubcolmena.com.ar',
                    asunto: 'Test Email Personalizado',
                    titulo: 'Bienvenido al Club de Cocina',
                    subtitulo: 'Gracias por unirte a nuestra comunidad',
                    contenido: 'Este es un email personalizado de prueba.',
                    boton: {
                        texto: 'Explorar Cursos',
                        url: 'https://clubcolmena.com.ar/cursos'
                    }
                };
                await testTemplate('email_personalizado', personalData);
                showTestResult('preview-personalizado', 'Plantilla de Email Personalizado probada correctamente');
            } catch (error) {
                showTestResult('preview-personalizado', `Error: ${error.message}`, 'error');
            }
        }

        async function testTemplate(tipo, data) {
            const scriptUrl = localStorage.getItem('appsScriptUrl') || prompt('Ingrese la URL del Apps Script:');
            if (!scriptUrl) throw new Error('URL del Apps Script requerida');
            
            const payload = { ...data, tipo: tipo };
            
            const response = await fetch(scriptUrl, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });
            
            if (!response.ok) {
                throw new Error(`HTTP ${response.status}: ${response.statusText}`);
            }
            
            const result = await response.json();
            if (!result.success) {
                throw new Error(result.error || 'Error desconocido');
            }
            
            return result;
        }

        function showTestResult(elementId, message, type = 'success') {
            const element = document.getElementById(elementId);
            const bgColor = type === 'error' ? '#f8d7da' : (type === 'info' ? '#d1ecf1' : '#d4edda');
            const textColor = type === 'error' ? '#721c24' : (type === 'info' ? '#0c5460' : '#155724');
            
            element.innerHTML = `
                <div style="background: ${bgColor}; color: ${textColor}; padding: 15px; border-radius: 5px; margin: 10px 0;">
                    ${message}
                    ${type === 'success' ? '<br><small>Las plantillas usan estructura de tablas HTML con estilos inline para m√°xima compatibilidad con webmails.</small>' : ''}
                </div>
            `;
        }

        function saveScriptUrl() {
            const urlInput = document.getElementById('script-url-input');
            const url = urlInput.value.trim();
            
            if (!url) {
                alert('Por favor ingrese una URL v√°lida');
                return;
            }
            
            if (!url.includes('script.google.com')) {
                alert('La URL debe ser de Google Apps Script (script.google.com)');
                return;
            }
            
            localStorage.setItem('appsScriptUrl', url);
            alert('URL guardada correctamente');
        }

        // Mostrar informaci√≥n del sistema
        document.addEventListener('DOMContentLoaded', function() {
            const urlInput = document.getElementById('script-url-input');
            const savedUrl = localStorage.getItem('appsScriptUrl');
            if (savedUrl) {
                urlInput.value = savedUrl;
            }
        });
    </script>
</body>
</html>